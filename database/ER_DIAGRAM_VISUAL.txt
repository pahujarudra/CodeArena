/*******************************************************************************
 * CodeArena - Entity Relationship Diagram (ERD)
 * Visual Representation in Text Format
 * 
 * For your DBMS academic report, you can use this as reference to create
 * a visual diagram using tools like:
 * - MySQL Workbench (File > Create Model from Database)
 * - draw.io / diagrams.net
 * - Lucidchart
 * - dbdiagram.io
 * - PlantUML
 ******************************************************************************/

/*******************************************************************************
 * DETAILED ER DIAGRAM (Text Format)
 ******************************************************************************/

┌─────────────────────────────────────────────────────────────────────────────┐
│                          CODEARENA DATABASE SCHEMA                          │
└─────────────────────────────────────────────────────────────────────────────┘


┏━━━━━━━━━━━━━━━━━━━━━━┓
┃       USERS          ┃
┃━━━━━━━━━━━━━━━━━━━━━━┃
┃ PK user_id           ┃ ──────┐
┃    username (UQ)     ┃       │
┃    fullname          ┃       │
┃    email (UQ)        ┃       │ 1
┃    photo_url         ┃       │
┃    is_admin          ┃       │
┃    problems_solved   ┃       │
┃    total_points      ┃       │
┃    total_submissions ┃       │
┃    contests_part.    ┃       │
┃    easy_probs_solved ┃       │
┃    medium_p_solved   ┃       │
┃    hard_probs_solved ┃       │
┃    created_at        ┃       │
┃    updated_at        ┃       │
┗━━━━━━━━━━━━━━━━━━━━━━┛       │
         │                     │
         │ 1                   │
         │                     │
         │ N                   │ N
         │                     │
         ↓                     ↓
┏━━━━━━━━━━━━━━━━━━━━━━┓   ┏━━━━━━━━━━━━━━━━━━━━━━┓
┃   USER_ACTIVITIES    ┃   ┃    SUBMISSIONS       ┃
┃━━━━━━━━━━━━━━━━━━━━━━┃   ┃━━━━━━━━━━━━━━━━━━━━━━┃
┃ PK activity_id       ┃   ┃ PK submission_id     ┃
┃ FK user_id           ┃   ┃ FK user_id           ┃
┃ FK problem_id        ┃   ┃ FK problem_id        ┃───────┐
┃ FK contest_id        ┃   ┃ FK contest_id        ┃───┐   │
┃    problem_title     ┃   ┃    code              ┃   │   │
┃    contest_title     ┃   ┃    language          ┃   │   │
┃    status            ┃   ┃    status            ┃   │   │
┃    difficulty        ┃   ┃    passed_tests      ┃   │   │
┃    passed_tests      ┃   ┃    total_tests       ┃   │   │
┃    total_tests       ┃   ┃    points_earned     ┃   │   │
┃    activity_timestamp┃   ┃    submitted_at      ┃   │   │
┗━━━━━━━━━━━━━━━━━━━━━━┛   ┗━━━━━━━━━━━━━━━━━━━━━━┛   │   │
         │                              │              │   │
         │                              │ N            │   │
         └──────────────────────────────┼──────────────┘   │
                                        │                  │
                                        │                  │
                                        │ 1                │ N
                                        │                  │
                                        ↓                  │
                              ┏━━━━━━━━━━━━━━━━━━━━━━┓    │
                              ┃      PROBLEMS        ┃ ←──┘
                              ┃━━━━━━━━━━━━━━━━━━━━━━┃
                              ┃ PK problem_id        ┃
                              ┃ FK contest_id        ┃───────┐
                              ┃    title             ┃       │
                              ┃    description       ┃       │
                              ┃    difficulty        ┃       │
                              ┃    points            ┃       │
                              ┃    time_limit        ┃       │
                              ┃    memory_limit      ┃       │
                              ┃    constraints       ┃       │
                              ┃    input_format      ┃       │
                              ┃    output_format     ┃       │
                              ┃    sample_input      ┃       │
                              ┃    sample_output     ┃       │
                              ┃    total_submissions ┃       │
                              ┃    accepted_subm.    ┃       │
                              ┃    created_at        ┃       │
                              ┃    updated_at        ┃       │
                              ┗━━━━━━━━━━━━━━━━━━━━━━┛       │
                                        │                   │
                                        │ 1                 │
                                        │                   │
                                        │ N                 │ N
                                        │                   │
                                        ↓                   │
                              ┏━━━━━━━━━━━━━━━━━━━━━━┓      │
                              ┃    TEST_CASES        ┃      │
                              ┃━━━━━━━━━━━━━━━━━━━━━━┃      │
                              ┃ PK test_case_id      ┃      │
                              ┃ FK problem_id        ┃      │
                              ┃    input_data        ┃      │
                              ┃    expected_output   ┃      │
                              ┃    is_hidden         ┃      │
                              ┃    test_order        ┃      │
                              ┃    created_at        ┃      │
                              ┗━━━━━━━━━━━━━━━━━━━━━━┛      │
                                                             │
                                                             │ 1
                                                             │
                                                             ↓
                                                   ┏━━━━━━━━━━━━━━━━━━━━━━┓
                                                   ┃      CONTESTS        ┃
                                                   ┃━━━━━━━━━━━━━━━━━━━━━━┃
                                                   ┃ PK contest_id        ┃
                                                   ┃    title             ┃
                                                   ┃    description       ┃
                                                   ┃    start_time        ┃
                                                   ┃    end_time          ┃
                                                   ┃    problem_count     ┃
                                                   ┃    created_at        ┃
                                                   ┃    updated_at        ┃
                                                   ┗━━━━━━━━━━━━━━━━━━━━━━┛
                                                             ↑
                                                             │
                                                             │ N
                         ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┃━━━━━━━━━┓
                         ┃      CONTEST_PARTICIPANTS          M        ┃
                         ┃━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┃
                         ┃ PK participation_id                         ┃
                         ┃ FK user_id                                  ┃ ←───────┐
                         ┃ FK contest_id                               ┃         │
                         ┃    joined_at                                ┃         │
                         ┃    UNIQUE (user_id, contest_id)             ┃         │
                         ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛         │
                                                                                  │
                                                                                  │
                                                                                  │
                                                         M : N Relationship ──────┘
                                                         (Many-to-Many)


/*******************************************************************************
 * CARDINALITY NOTATION
 ******************************************************************************/

USERS (1) ────────────< (N) SUBMISSIONS
   │                            │
   │                            │
   │ (1)                        │ (N)
   │                            │
   ↓ (N)                        ↓ (1)
USER_ACTIVITIES            PROBLEMS
                               │
                               │ (N)
                               │
                               ↓ (1)
                           CONTESTS
                               ↑
                               │
                               │ (N)
                        ┌──────┴──────┐
                        │             │
                   (M) USERS ←→ (M) CONTESTS
                        └─────────────┘
                    (via CONTEST_PARTICIPANTS)

PROBLEMS (1) ────────────< (N) TEST_CASES


/*******************************************************************************
 * RELATIONSHIP TYPES
 ******************************************************************************/

1. ONE-TO-MANY RELATIONSHIPS:
   ├─ USERS → SUBMISSIONS (One user makes many submissions)
   ├─ USERS → USER_ACTIVITIES (One user has many activities)
   ├─ CONTESTS → PROBLEMS (One contest has many problems)
   ├─ CONTESTS → SUBMISSIONS (One contest has many submissions)
   ├─ PROBLEMS → SUBMISSIONS (One problem receives many submissions)
   └─ PROBLEMS → TEST_CASES (One problem has many test cases)

2. MANY-TO-MANY RELATIONSHIPS:
   └─ USERS ↔ CONTESTS (via CONTEST_PARTICIPANTS)
      Many users can participate in many contests


/*******************************************************************************
 * FOREIGN KEY CONSTRAINTS
 ******************************************************************************/

submissions.user_id → users.user_id (ON DELETE CASCADE)
submissions.problem_id → problems.problem_id (ON DELETE CASCADE)
submissions.contest_id → contests.contest_id (ON DELETE SET NULL)

user_activities.user_id → users.user_id (ON DELETE CASCADE)
user_activities.problem_id → problems.problem_id (ON DELETE CASCADE)
user_activities.contest_id → contests.contest_id (ON DELETE SET NULL)

problems.contest_id → contests.contest_id (ON DELETE CASCADE)

test_cases.problem_id → problems.problem_id (ON DELETE CASCADE)

contest_participants.user_id → users.user_id (ON DELETE CASCADE)
contest_participants.contest_id → contests.contest_id (ON DELETE CASCADE)


/*******************************************************************************
 * CONSTRAINTS SUMMARY
 ******************************************************************************/

PRIMARY KEYS:
  users.user_id
  contests.contest_id
  problems.problem_id
  test_cases.test_case_id
  submissions.submission_id
  contest_participants.participation_id
  user_activities.activity_id

UNIQUE CONSTRAINTS:
  users.username
  users.email
  contest_participants (user_id, contest_id)

CHECK CONSTRAINTS:
  contests: end_time > start_time

FOREIGN KEYS: 12 total
  (See Foreign Key Constraints section above)


/*******************************************************************************
 * ATTRIBUTE TYPES
 ******************************************************************************/

┌──────────────────┬─────────────────┬──────────────────────────────────────┐
│ Entity           │ Key Attributes  │ Non-Key Attributes                   │
├──────────────────┼─────────────────┼──────────────────────────────────────┤
│ USERS            │ user_id (PK)    │ username, fullname, email,           │
│                  │                 │ photo_url, is_admin, stats, dates    │
├──────────────────┼─────────────────┼──────────────────────────────────────┤
│ CONTESTS         │ contest_id (PK) │ title, description, start_time,      │
│                  │                 │ end_time, problem_count, dates       │
├──────────────────┼─────────────────┼──────────────────────────────────────┤
│ PROBLEMS         │ problem_id (PK) │ title, description, difficulty,      │
│                  │ contest_id (FK) │ points, limits, formats, stats       │
├──────────────────┼─────────────────┼──────────────────────────────────────┤
│ TEST_CASES       │ test_case_id(PK)│ input_data, expected_output,         │
│                  │ problem_id (FK) │ is_hidden, test_order, created_at    │
├──────────────────┼─────────────────┼──────────────────────────────────────┤
│ SUBMISSIONS      │ submission_id(PK│ code, language, status,              │
│                  │ user_id (FK)    │ passed_tests, total_tests, points,   │
│                  │ problem_id (FK) │ submitted_at                         │
│                  │ contest_id (FK) │                                      │
├──────────────────┼─────────────────┼──────────────────────────────────────┤
│ CONTEST_         │ participation_id│ joined_at                            │
│ PARTICIPANTS     │ (PK)            │                                      │
│                  │ user_id (FK)    │                                      │
│                  │ contest_id (FK) │                                      │
├──────────────────┼─────────────────┼──────────────────────────────────────┤
│ USER_ACTIVITIES  │ activity_id (PK)│ problem_title, contest_title,        │
│                  │ user_id (FK)    │ status, difficulty, tests,           │
│                  │ problem_id (FK) │ activity_timestamp                   │
│                  │ contest_id (FK) │                                      │
└──────────────────┴─────────────────┴──────────────────────────────────────┘


/*******************************************************************************
 * NORMALIZATION ANALYSIS
 ******************************************************************************/

FIRST NORMAL FORM (1NF) ✓
  • All attributes contain atomic values
  • No repeating groups (arrays converted to separate tables)
  • Each table has a primary key
  • No multi-valued attributes

SECOND NORMAL FORM (2NF) ✓
  • Satisfies 1NF
  • All non-key attributes fully depend on the entire primary key
  • No partial dependencies

THIRD NORMAL FORM (3NF) ✓
  • Satisfies 2NF
  • No transitive dependencies
  • Exception: user_activities has denormalized columns (problem_title,
    contest_title) for performance optimization of activity feeds

BOYCE-CODD NORMAL FORM (BCNF) ✓
  • Satisfies 3NF
  • Every determinant is a candidate key


/*******************************************************************************
 * SIMPLIFIED ER DIAGRAM FOR REPORTS
 ******************************************************************************/

                    USERS
                      │
        ┌─────────────┼─────────────┐
        │             │             │
        ↓             ↓             ↓
  USER_ACTIVITIES  SUBMISSIONS  CONTEST_PARTICIPANTS
                      │             │
                      │             ↓
                      │          CONTESTS
                      │             │
                      ↓             ↓
                   PROBLEMS ←───────┘
                      │
                      ↓
                  TEST_CASES


/*******************************************************************************
 * ENTITY PARTICIPATION
 ******************************************************************************/

TOTAL PARTICIPATION (Mandatory):
  • PROBLEMS must belong to a CONTEST
  • TEST_CASES must belong to a PROBLEM
  • SUBMISSIONS must be made by a USER for a PROBLEM
  • USER_ACTIVITIES must be performed by a USER on a PROBLEM

PARTIAL PARTICIPATION (Optional):
  • USERS may or may not make SUBMISSIONS
  • CONTESTS may or may not have SUBMISSIONS (new contests)
  • SUBMISSIONS may or may not be part of a CONTEST (practice problems)


/*******************************************************************************
 * INDEXES FOR PERFORMANCE
 ******************************************************************************/

Primary Indexes (Automatic):
  • All primary keys are automatically indexed

Secondary Indexes:
  • users: (username), (email), (total_points DESC, problems_solved DESC)
  • contests: (start_time DESC), (end_time), (start_time, end_time)
  • problems: (contest_id), (difficulty), (points)
  • test_cases: (problem_id), (problem_id, test_order)
  • submissions: (user_id), (problem_id), (contest_id), (submitted_at DESC)
  • contest_participants: (user_id), (contest_id)
  • user_activities: (user_id, activity_timestamp DESC)

Composite Indexes:
  • submissions: (user_id, contest_id, status, points_earned)
  • problems: (difficulty, accepted_submissions, total_submissions)
  • submissions: (user_id, problem_id)


/*******************************************************************************
 * VIEWS (VIRTUAL TABLES)
 ******************************************************************************/

1. contest_status_view
   Purpose: Add real-time status to contests (active/upcoming/ended)
   
2. problem_stats_view
   Purpose: Calculate acceptance rates and aggregate problem statistics
   
3. leaderboard_view
   Purpose: Rank users by points and problems solved
   
4. submission_history_view
   Purpose: Join submissions with user/problem/contest details


/*******************************************************************************
 * TRIGGERS (AUTOMATIC ACTIONS)
 ******************************************************************************/

1. after_problem_insert
   Action: Increment contest.problem_count when problem added
   
2. after_problem_delete
   Action: Decrement contest.problem_count when problem deleted
   
3. after_submission_insert
   Action: Update user stats, problem stats, and add activity record


/*******************************************************************************
 * STORED PROCEDURES
 ******************************************************************************/

1. update_user_stats_after_submission(user_id, problem_id, contest_id, ...)
   Purpose: Update user statistics after submission
   
2. update_problem_stats_after_submission(problem_id, is_accepted)
   Purpose: Update problem submission/acceptance counts
   
3. add_user_activity(user_id, problem_id, ...)
   Purpose: Add activity to user feed (keep last 10)


/*******************************************************************************
 * BUSINESS RULES IMPLEMENTED
 ******************************************************************************/

1. Contest end time must be after start time (CHECK constraint)
2. Each user can participate in a contest only once (UNIQUE constraint)
3. Deleting a contest removes all its problems (CASCADE)
4. Deleting a problem removes all its test cases (CASCADE)
5. Deleting a user removes all their submissions (CASCADE)
6. Submissions automatically update user and problem statistics (TRIGGER)
7. User activity feed limited to 10 most recent items (STORED PROCEDURE)


/*******************************************************************************
 * SAMPLE DATA FLOW
 ******************************************************************************/

User Submission Flow:
  1. User submits code for a problem
  2. Record inserted into SUBMISSIONS table
  3. Trigger after_submission_insert fires
  4. Stored procedures update:
     • users.total_submissions (+1)
     • users.problems_solved (+1 if first time accepted)
     • users.total_points (+points if accepted)
     • problems.total_submissions (+1)
     • problems.accepted_submissions (+1 if accepted)
  5. Activity record added to USER_ACTIVITIES
  6. Contest participation tracked in CONTEST_PARTICIPANTS


/*******************************************************************************
 * END OF ER DIAGRAM
 ******************************************************************************/

For a visual representation, import this schema into:
  • MySQL Workbench: Database > Reverse Engineer
  • dbdiagram.io: Paste table definitions
  • draw.io: Use entity shapes and relationships
